spring:
  application:
    name: apex-trading-bot
  datasource:
    driver-class-name: org.postgresql.Driver
    url: ${SPRING_DATASOURCE_URL}
    username: ${SPRING_DATASOURCE_USERNAME}
    password: ${SPRING_DATASOURCE_PASSWORD}
  jpa:
    hibernate:
      ddl-auto: validate
      naming:
        physical-strategy: org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
        implicit-strategy: org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl
    #show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
  flyway:
    enabled: true
    baseline-on-migrate: true

server:
  port: ${PORT:8080}
  address: 0.0.0.0

jwt:
  secret: ${JWT_SECRET}
  expiration: 3600000
  refresh-expiration: 604800000

fyers:
  api:
    app-id: ${FYERS_API_APP_ID:${FYERS_APP_ID:}}
    secret-key: ${FYERS_API_SECRET_KEY:${FYERS_SECRET_KEY:}}
    access-token: ${FYERS_ACCESS_TOKEN:}
    base-url: ${FYERS_API_BASE_URL:https://api-t1.fyers.in/api/v3}
    refresh-url: ${FYERS_REFRESH_URL:https://api-t1.fyers.in/api/v3/refresh-token}
    rate-limit-backoff-seconds: 5
  redirect-uri: ${FYERS_REDIRECT_URI:http://localhost:4200/auth/fyers/callback}
  data:
    base-url: ${FYERS_DATA_BASE_URL:https://api-t1.fyers.in/data}
  resilience:
    circuit:
      failure-rate-threshold: 50
      wait-open-seconds: 30
      sliding-window-size: 20
    rate:
      limit-per-second: 8
      timeout-ms: 0
    retry:
      max-attempts: 4
      base-delay-ms: 500
      jitter-factor: 0.2

management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      show-details: when_authorized

logging:
  level:
    com.apex.backend: DEBUG
    org.springframework.security: DEBUG
    org.hibernate.SQL: DEBUG
    com.zaxxer.hikari: DEBUG
    org.flywaydb: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} [cid=%X{correlationId} oid=%X{orderId}] - %msg%n"

apex:
  dev:
    enabled: ${APEX_DEV_ENABLED:false}
  scanner:
    enabled: true
    scheduler-enabled: false
    mode: MANUAL
    interval: 60
    default-timeframe: ${APEX_SCANNER_DEFAULT_TIMEFRAME:5}
    default-regime: ${APEX_SCANNER_DEFAULT_REGIME:AUTO}
    market-open: ${APEX_SCANNER_MARKET_OPEN:09:15}
    market-close: ${APEX_SCANNER_MARKET_CLOSE:15:30}
    max-candidates: ${APEX_SCANNER_MAX_CANDIDATES:5}
    require-manual-approval: ${APEX_SCANNER_REQUIRE_MANUAL_APPROVAL:false}
    universes:
      nifty50: ${APEX_SCANNER_NIFTY50:}
      nifty200: ${APEX_SCANNER_NIFTY200:}
  trading:
    paper-mode: ${APEX_TRADING_PAPER_MODE:true}
    paper-signal-orders-enabled: ${APEX_TRADING_PAPER_SIGNAL_ORDERS_ENABLED:false}
  strategy:
    min-candle-count: ${APEX_STRATEGY_MIN_CANDLE_COUNT:50}
    rsi-goldilocks-min: ${APEX_STRATEGY_RSI_GOLDILOCKS_MIN:40.0}
    rsi-goldilocks-max: ${APEX_STRATEGY_RSI_GOLDILOCKS_MAX:70.0}
    macd-min-momentum-score: ${APEX_STRATEGY_MACD_MIN_MOMENTUM_SCORE:4.0}
    macd-momentum-scale: ${APEX_STRATEGY_MACD_MOMENTUM_SCALE:11.0}
    macd-histogram-min: ${APEX_STRATEGY_MACD_HISTOGRAM_MIN:0.0}
    adx-threshold: ${APEX_STRATEGY_ADX_THRESHOLD:20.0}
    adx-strong-threshold: ${APEX_STRATEGY_ADX_STRONG_THRESHOLD:25.0}
    atr-min-percent: ${APEX_STRATEGY_ATR_MIN_PERCENT:0.3}
    atr-max-percent: ${APEX_STRATEGY_ATR_MAX_PERCENT:6.0}
    min-entry-score: ${APEX_STRATEGY_MIN_ENTRY_SCORE:65}
    grade-aaa-threshold: ${APEX_STRATEGY_GRADE_AAA_THRESHOLD:90}
    grade-aa-threshold: ${APEX_STRATEGY_GRADE_AA_THRESHOLD:85}
    grade-a-threshold: ${APEX_STRATEGY_GRADE_A_THRESHOLD:80}
    momentum-weight: ${APEX_STRATEGY_MOMENTUM_WEIGHT:20.0}
    trend-weight: ${APEX_STRATEGY_TREND_WEIGHT:20.0}
    rsi-weight: ${APEX_STRATEGY_RSI_WEIGHT:20.0}
    volatility-weight: ${APEX_STRATEGY_VOLATILITY_WEIGHT:20.0}
    squeeze-weight: ${APEX_STRATEGY_SQUEEZE_WEIGHT:20.0}
  ui:
    api-base-url: ${APEX_UI_API_BASE_URL:http://127.0.0.1:8080/api}
    ws-url: ${APEX_UI_WS_URL:ws://127.0.0.1:8080/ws}
  bootstrap:
    default-users: true
  security:
    cors:
      allowed-origins: ${APEX_ALLOWED_ORIGINS:}
    websocket:
      allowed-origins: ${APEX_ALLOWED_ORIGINS:}
    public-health-endpoint: ${APEX_PUBLIC_HEALTH_ENDPOINT:true}
  admin:
    token: ${APEX_ADMIN_TOKEN:}
  ws:
    broadcastTopics: ${APEX_WS_BROADCAST_TOPICS:false}
  rate-limit:
    scanner:
      limit-per-minute: ${APEX_RATE_LIMIT_SCANNER_PER_MINUTE:2}
      timeout-ms: ${APEX_RATE_LIMIT_SCANNER_TIMEOUT_MS:0}
    trade:
      limit-per-second: ${APEX_RATE_LIMIT_TRADE_PER_SECOND:5}
      timeout-ms: ${APEX_RATE_LIMIT_TRADE_TIMEOUT_MS:0}
  advanced:
    market-regime:
      trending-adx-threshold: 25.0
      strong-trend-adx: 30.0
      high-vol-atr-percent: 3.0
      low-vol-atr-percent: 1.0
      chop-filter-enabled: false
      chop-period: 14
      choppy-threshold: 61.8

    macd-confirmation:
      divergence-lookback: 30
      histogram-slope-lookback: 3

    candle-confirmation:
      required-candles: 3
      volume-confirmation: true
      volume-multiplier: 1.2
      avg-volume-period: 20

    multi-timeframe-momentum:
      weights:
        5m: 0.4
        15m: 0.3
        1h: 0.2
        1d: 0.1
      conflict-penalty: 0.15

    risk:
      max-portfolio-heat-pct: 0.06
      correlation-threshold: 0.7
      correlation-lookback: 50
      kelly-lookback-trades: 50
      kelly-fraction: 0.25
      max-daily-loss-pct: 0.02
      max-weekly-loss-pct: 0.1
      max-monthly-loss-pct: 0.15
      circuit-breakers:
        enabled: false
        max-consecutive-losses: 2
        cooldown-minutes: 45

    execution-cost:
      spread-bps: 5.0
      slippage-atr-pct: 0.1
      commission-pct: 0.0003
      stt-pct: 0.00025
      txn-pct: 0.00003
      sebi-pct: 0.000001
      gst-pct: 0.18

    liquidity:
      min-rupee-volume: 2000000.0
      max-spread-pct: 0.3
      max-order-pct-daily-volume: 0.02
      impact-lambda: 0.1
      gate-enabled: false

    backtest:
      max-bars-in-trade: 50
      in-sample-bars: 200
      out-sample-bars: 100
      decay-lookback-trades: 20
      time-stop-bars: 12
      time-stop-min-move-r: 0.3
      chandelier-atr-mult: 3.0

    broker:
      failure-threshold: 3
      cool-down-seconds: 120

    audit:
      retention-days: 30

strategy:
  macd:
    fast-period: 12
    slow-period: 26
    signal-period: 9
    min-momentum-score: 6.0
  adx:
    period: 14
    threshold: 25.0
    strong: 30.0
  rsi:
    period: 14
    goldilocks-min: 45.0
    goldilocks-max: 65.0
    overbought: 70.0
    oversold: 30.0
  atr:
    period: 14
    min-percent: 0.5
    max-percent: 5.0
    stop-multiplier: 1.5
    target-multiplier: 3.0
  bollinger:
    period: 20
    deviation: 2.0
  keltner:
    period: 20
    atr-multiplier: 1.5
  squeeze:
    min-bars: 5
    tight-threshold: 0.8
  exit:
    breakeven-threshold: 0.5
    trailing-threshold: 1.5
    trailing-multiplier: 1.5
    time-stop-bars: 20
    max-bars: 50
  sizing:
    base-risk: 0.01
    multiplier-aaa: 2.0
    multiplier-aa: 1.5
    multiplier-a: 1.0
    dynamic:
      enabled: false
      min-multiplier: 0.5
      max-multiplier: 1.0
      score-floor: 60
      score-ceil: 90
  circuit:
    daily-loss-limit: 0.02
    weekly-loss-limit: 0.10
    monthly-loss-limit: 0.15
    max-consecutive-losses: 3
    auto-pause: true
  scoring:
    momentum-weight: 20.0
    trend-weight: 20.0
    rsi-weight: 20.0
    volatility-weight: 20.0
    squeeze-weight: 20.0
  scanner:
    max-candidates: 5
    require-manual-approval: false
  health:
    rolling-trades: 30
    min-expectancy: 0.1
    min-sharpe: 0.5
    max-drawdown-pct: 0.1
    max-consecutive-loss-probability: 0.2
  breakout:
    use-donchian: false
    donchian-period: 20
    require-structure-breakout: false
  trading-window:
    enabled: false
    timezone: "Asia/Kolkata"
    windows:
      - "09:20-11:30"
      - "13:45-15:10"
    blackout: []
  market-gate:
    enabled: false
    index-symbol: "NSE:NIFTY50-EQ"
    ema-fast: 50
    ema-slow: 200
    require-price-above-fast-ema: true
    block-if-index-data-stale: true
    max-stale-seconds: 300
  vol-shock:
    enabled: false
    lookback: 50
    multiplier: 1.8
    cooldown-bars: 6

execution:
  spread-pct: 0.0005
  slippage-atr-pct: 0.1
  impact-factor: 0.05
  avg-daily-notional: 10000000.0
  latency-millis: 200
  latency-move-pct-per-second: 0.0005
  limit-fill-max-distance-pct: 0.002
  limit-fill-volume-factor: 0.2
  default-order-type: MARKET

  entry-timeout-seconds: 30
  stop-ack-timeout-seconds: 5
  cancel-on-timeout: true

  partial-fill:
    policy: CANCEL_REMAIN   # CANCEL_REMAIN | KEEP_OPEN | CANCEL_AND_FLATTEN
    min-fill-pct: 80.0
    cancel-timeout-seconds: 5

analytics:
  validation:
    bootstrap-samples: 500
    num-trials: 50
  cvar:
    confidence: 95

risk:
  ruin:
    risk-per-trade-pct: 0.01
    bankroll-r: 50

  correlation:
    lookback: 50
    spike-threshold: 0.75
    sizing-multiplier-on-spike: 0.5

  trade-cooldown:
    minutes: 5   # Cooldown period per symbol after trade

data-quality:
  max-missing-candles: 1
  max-gap-multiplier: 2.0
  outlier-pct: 0.1
  max-stale-seconds: 300   # 5 minutes

reconcile:
  enabled: true
  interval-ms: 60000
  safe-mode-on-mismatch: true
  qty-tolerance: 1
  price-tolerance-pct: 0.25
  auto-cancel-pending-on-mismatch: true
  auto-flatten-on-mismatch: true
  panic-on-mismatch: false

exit-retry:
  poll-interval-ms: 15000
  retry-delay-seconds: 30
  max-attempts: 10
  max-delay-seconds: 300

apex:
  risk:
    daily-max-loss: 2000
    max-consecutive-losses: 3
    stop-loss-failure-mode: SAFE
    heat-max-pct: 0.06
    enforce-enabled: true
    enforce-interval-ms: 60000

crisis:
  enabled: true
  index-symbol: NSE:NIFTY50-EQ
  drop-threshold-pct: 5.0
  vix-threshold: 30.0
  halt-duration-minutes: 30
  check-interval-ms: 60000

security:
  token-encryption-key: ${SECURITY_TOKEN_ENCRYPTION_KEY:}

guard:
  admin-token: ${GUARD_ADMIN_TOKEN:}
