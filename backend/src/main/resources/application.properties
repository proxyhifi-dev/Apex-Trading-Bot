# =============================================================================
# Application Configuration
# =============================================================================
spring.application.name=apex-trading-bot

# =============================================================================
# Server Configuration
# =============================================================================
server.port=${PORT:8080}


# =============================================================================
# Database Configuration
# =============================================================================
spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}


# =============================================================================
# JPA / Hibernate Configuration
# =============================================================================
# Use validate in prod-like, use update in dev if you want Hibernate to auto-create (Flyway preferred)
spring.jpa.hibernate.ddl-auto=validate

spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# ? FIX: Spring Boot 3.4 compatible naming strategies (avoid missing Spring*NamingStrategy classes)
spring.jpa.hibernate.naming.physical-strategy=org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
spring.jpa.hibernate.naming.implicit-strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl

# =============================================================================
# Flyway
# =============================================================================
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true

# =============================================================================
# JWT Configuration (env-only)
# =============================================================================
# IMPORTANT: set JWT_SECRET in your environment before running
jwt.secret=${JWT_SECRET}
jwt.expiration=3600000
jwt.refresh-expiration=604800000

# =============================================================================
# FYERS API Configuration (env preferred)
# =============================================================================
fyers.api.app-id=${FYERS_API_APP_ID:${FYERS_APP_ID:}}
fyers.api.secret-key=${FYERS_API_SECRET_KEY:${FYERS_SECRET_KEY:}}
fyers.redirect-uri=${FYERS_REDIRECT_URI:http://localhost:4200/auth/fyers/callback}
fyers.api.access-token=${FYERS_ACCESS_TOKEN:}
fyers.api.base-url=${FYERS_API_BASE_URL:https://api-t1.fyers.in/api/v3}
fyers.data.base-url=${FYERS_DATA_BASE_URL:https://api-t1.fyers.in/data}
fyers.api.refresh-url=${FYERS_REFRESH_URL:https://api-t1.fyers.in/api/v3/refresh-token}

# =============================================================================
# Actuator / Observability
# =============================================================================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when_authorized

# =============================================================================
# Logging Configuration
# =============================================================================
logging.level.com.apex.backend=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} [cid=%X{correlationId} oid=%X{orderId}] - %msg%n

# =============================================================================
# Bot Configuration
# =============================================================================
apex.scanner.interval=60

# Strategy Configuration
strategy.macd.fast-period=12
strategy.macd.slow-period=26
strategy.macd.signal-period=9
strategy.macd.min-momentum-score=6.0

strategy.adx.period=14
strategy.adx.threshold=25.0
strategy.adx.strong=30.0

strategy.rsi.period=14
strategy.rsi.goldilocks-min=45.0
strategy.rsi.goldilocks-max=65.0
strategy.rsi.overbought=70.0
strategy.rsi.oversold=30.0

strategy.atr.period=14
strategy.atr.min-percent=0.5
strategy.atr.max-percent=5.0
strategy.atr.stop-multiplier=1.5
strategy.atr.target-multiplier=3.0

strategy.bollinger.period=20
strategy.bollinger.deviation=2.0

strategy.keltner.period=20
strategy.keltner.atr-multiplier=1.5

strategy.squeeze.min-bars=5
strategy.squeeze.tight-threshold=0.8

strategy.exit.breakeven-threshold=0.5
strategy.exit.trailing-threshold=1.5
strategy.exit.trailing-multiplier=1.5
strategy.exit.time-stop-bars=20
strategy.exit.max-bars=50

strategy.sizing.base-risk=0.01
strategy.sizing.multiplier-aaa=2.0
strategy.sizing.multiplier-aa=1.5
strategy.sizing.multiplier-a=1.0

strategy.circuit.daily-loss-limit=0.02
strategy.circuit.weekly-loss-limit=0.10
strategy.circuit.monthly-loss-limit=0.15
strategy.circuit.max-consecutive-losses=3
strategy.circuit.auto-pause=true

strategy.scoring.momentum-weight=20.0
strategy.scoring.trend-weight=20.0
strategy.scoring.rsi-weight=20.0
strategy.scoring.volatility-weight=20.0
strategy.scoring.squeeze-weight=20.0

strategy.scanner.max-candidates=5
strategy.scanner.require-manual-approval=false

# UI Integration Configuration
# =============================================================================
apex.ui.api-base-url=${APEX_UI_API_BASE_URL:http://127.0.0.1:8080/api}
apex.ui.ws-url=${APEX_UI_WS_URL:ws://127.0.0.1:8080/ws}

# =============================================================================
# Bootstrap controls
# =============================================================================
apex.bootstrap.default-users=true

# =============================================================================
# FYERS Resilience
# =============================================================================
fyers.resilience.circuit.failure-rate-threshold=50
fyers.resilience.circuit.wait-open-seconds=30
fyers.resilience.circuit.sliding-window-size=20
fyers.resilience.rate.limit-per-second=8
fyers.resilience.rate.timeout-ms=0
fyers.resilience.retry.max-attempts=4
fyers.resilience.retry.base-delay-ms=500
fyers.resilience.retry.jitter-factor=0.2

# =============================================================================
# Security (CORS/WebSocket)
# =============================================================================
apex.security.cors.allowed-origins=${APEX_ALLOWED_ORIGINS:}
apex.security.websocket.allowed-origins=${APEX_ALLOWED_ORIGINS:}
guard.admin-token=${GUARD_ADMIN_TOKEN:}
apex.admin.token=${APEX_ADMIN_TOKEN:}
apex.ws.broadcastTopics=${APEX_WS_BROADCAST_TOPICS:false}

logging.level.com.zaxxer.hikari=DEBUG
logging.level.org.flywaydb=DEBUG
